{% import 'partials/_macros.html.twig' as macros %}
{% set post = post is defined ? post : {} %}

<form method="POST" action="{{ path(action, { id: post.id|default(null) }) }}" class="needs-validation" novalidate>
    {% if action == 'update_post' %}
        <input type="hidden" name="_method" value="PUT">
    {% endif %}

    <div class="mb-4">
        <label for="title" class="form-label fw-bold">Titre de l'Article</label>
        <input type="text" class="form-control form-control-lg" id="title" name="title" value="{{ post.title|default('') }}" placeholder="Entrez le titre..." required>
        <small class="text-muted">Soyez descriptif et clair</small>
        <div class="invalid-feedback">
            Le titre est requis.
        </div>
    </div>

    <div class="mb-4">
        <label for="content" class="form-label fw-bold">Contenu de l'Article</label>
        <textarea class="form-control" id="content" name="content" rows="8" placeholder="Écrivez votre contenu ici..." style="font-family: 'Segoe UI', sans-serif;" required>{{ post.content|default('') }}</textarea>
        <small class="text-muted">Vous pouvez utiliser du texte simple. HTML supporté.</small>
        <div class="invalid-feedback">
            Le contenu est requis.
        </div>
    </div>

    <div class="mb-4">
        <label for="picture" class="form-label fw-bold">Image</label>
        <input type="text" class="form-control" id="picture" name="picture" value="{{ post.picture|default('') }}" placeholder="https://example.com/image.jpg" required>
        <small class="text-muted">URL de l'image d'illustration</small>
        <div class="invalid-feedback">
            L'image est requise.
        </div>
    </div>

    <div class="mb-4">
        <label for="category" class="form-label fw-bold">Catégorie</label>
        <select class="form-control" id="category" name="category" required>
            <option value="">-- Sélectionner une catégorie --</option>
            {% if categories is defined %}
                {% for cat in categories %}
                    <option value="{{ cat.id }}" {% if post.category is defined and post.category.id == cat.id %}selected{% endif %}>{{ cat.name }}</option>
                {% endfor %}
            {% endif %}
        </select>
        <small class="text-muted">Choisissez la catégorie de cet article</small>
        <div class="invalid-feedback">
            La catégorie est requise.
        </div>
    </div>

    <div class="d-flex gap-3 pt-3">
        {% if action == 'update_post' %}
            {{ macros.btnPrimary('Mettre à Jour', 'lg', 'check-circle') }}
        {% else %}
            {{ macros.btnPrimary('Créer l\'Article', 'lg', 'check-circle') }}
        {% endif %}
        {{ macros.btnCancel('list_posts') }}
    </div>
</form>

<script>
    (function() {
        'use strict';
        const form = document.querySelector('.needs-validation');
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    })();
</script>
